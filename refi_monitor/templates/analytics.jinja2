<!-- Google Analytics 4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ config.get('GA4_MEASUREMENT_ID', 'G-KN2200EH78') }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '{{ config.get('GA4_MEASUREMENT_ID', 'G-KN2200EH78') }}', {
    'send_page_view': true,
    'cookie_flags': 'SameSite=None;Secure'
  });

  // Custom event tracking functions for RefiAlert
  window.trackEvent = function(eventName, params) {
    gtag('event', eventName, params || {});
  };

  // Conversion tracking
  window.trackConversion = function(conversionType, value) {
    gtag('event', 'conversion', {
      'event_category': 'engagement',
      'event_label': conversionType,
      'value': value || 0
    });
  };

  // Alert creation tracking
  window.trackAlertCreated = function(alertType, mortgageValue) {
    gtag('event', 'alert_created', {
      'event_category': 'alerts',
      'event_label': alertType,
      'value': mortgageValue
    });
  };

  // Payment tracking
  window.trackPayment = function(amount, alertId) {
    gtag('event', 'purchase', {
      'transaction_id': alertId,
      'value': amount,
      'currency': 'USD',
      'items': [{
        'item_name': 'Refinance Alert',
        'item_category': 'subscription',
        'price': amount,
        'quantity': 1
      }]
    });
  };

  // Blog/content engagement tracking (for future blog integration)
  window.trackContentView = function(contentType, contentId, contentTitle) {
    gtag('event', 'view_item', {
      'content_type': contentType,
      'content_id': contentId,
      'content_title': contentTitle
    });
  };

  window.trackContentShare = function(platform, contentId) {
    gtag('event', 'share', {
      'method': platform,
      'content_id': contentId
    });
  };

  window.trackNewsletterSignup = function(source) {
    gtag('event', 'sign_up', {
      'method': 'newsletter',
      'event_label': source || 'website'
    });
  };
</script>